<!-- Save as index.html and open in a browser (responsive for phones/tablets/desktops) -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>PixelCraft ‚Äî Responsive Student Budget Dashboard</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <style>
    :root{
      --bg: #F6F7FB;
      --card: #FFFFFF;
      --primary: #6B4EFF;
      --accent: #FFB443;
      --success: #3DDC84;
      --muted: #7B7F9A;
      --glass: rgba(255,255,255,0.6);
      --radius: 14px;
      --shadow-lg: 0 18px 40px rgba(99,85,255,0.10);
      --shadow-soft: 0 8px 20px rgba(27,31,69,0.06);
      --max-width: 1100px;
      --gap: clamp(12px, 2vw, 24px);
      --pad: clamp(12px, 2.2vw, 28px);
      --text-sm: clamp(12px, 1.6vw, 14px);
      --text-base: clamp(15px, 1.9vw, 16px);
      --text-lg: clamp(18px, 2.4vw, 20px);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,#F6F7FB 0%, #F2F5FF 100%);
      color:#12121a;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:var(--pad);
      -webkit-tap-highlight-color: transparent;
      line-height:1.35;
    }

    /* Layout container */
    .outer{
      max-width: var(--max-width);
      margin: 0 auto;
    }

    .container{
      display:grid;
      grid-template-columns: 1fr 360px;
      gap:var(--gap);
      align-items:start;
    }

    /* Header */
    header{
      grid-column:1/-1;
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:6px;
      gap:12px;
    }
    .greeting{
      display:flex;
      gap:12px;
      align-items:center;
      min-width:0;
    }
    .greeting h1{margin:0;font-size:var(--text-lg);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .greeting p{margin:0;color:var(--muted);font-size:var(--text-sm)}
    .avatar-3d{
      width:clamp(44px,6vw,56px);height:clamp(44px,6vw,56px);border-radius:12px;
      background:linear-gradient(135deg,#fff 0%, #f6f7ff 100%);
      box-shadow: var(--shadow-lg);
      display:flex;align-items:center;justify-content:center;
      transform-style:preserve-3d; perspective:800px;
      flex-shrink:0;
    }
    .avatar-3d .face{
      width:clamp(34px,5vw,44px);height:clamp(34px,5vw,44px);border-radius:10px;
      background:linear-gradient(180deg,#ffe6a8,#ffd080);
      transform: rotateX(8deg) rotateY(-10deg) translateZ(6px);
      display:flex;align-items:center;justify-content:center;font-weight:700;
      color:#3c2d6b;
      box-shadow: 0 6px 14px rgba(107,78,255,0.12);
      font-size:clamp(12px,2vw,16px);
    }

    /* Main column */
    .main{
      display:flex;flex-direction:column;gap:var(--gap);
    }

    /* Balance card */
    .balance-card{
      background:linear-gradient(180deg, rgba(255,255,255,0.92), rgba(255,255,255,0.98));
      border-radius:var(--radius);
      padding: clamp(14px,2.4vw,20px);
      box-shadow:var(--shadow-lg);
      display:flex;
      gap:16px;
      align-items:center;
      position:relative;
      overflow:visible;
      min-height:88px;
    }
    .balance-left{flex:1;min-width:0}
    .small-label{font-size:var(--text-sm);color:var(--muted);margin:0 0 6px 0}
    .big-amount{font-size:clamp(20px,3.2vw,28px);margin:0 0 8px 0;font-weight:700}
    .progress{
      height:12px;background:#EEF1FF;border-radius:999px;overflow:hidden;width:min(48vw,260px);
      box-shadow:var(--shadow-soft) inset;
    }
    .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--primary),#8A66FF);width:72%}

    /* 3D coin */
    .coin-wrap{
      width:clamp(86px,10vw,120px);height:clamp(86px,10vw,120px);
      display:flex;align-items:center;justify-content:center;
      perspective:900px;flex-shrink:0;
    }
    .coin{
      width:clamp(52px,6.4vw,72px);height:clamp(52px,6.4vw,72px);border-radius:50%;
      background:linear-gradient(135deg,#FFD549,#FFB443);
      display:flex;align-items:center;justify-content:center;
      font-weight:800;color:#7A4025;
      transform-style:preserve-3d;
      animation: spin 5s linear infinite;
      box-shadow: 0 14px 34px rgba(255,180,60,0.14), 0 6px 14px rgba(0,0,0,0.06);
      border:6px solid rgba(255,255,255,0.12);
      position:relative;
    }
    .coin::after{
      content:"‚Çπ";position:absolute;font-size:clamp(14px,2vw,22px);transform:translateZ(10px);
    }
    @keyframes spin{
      0%{transform: rotateY(0) rotateX(-6deg)}
      100%{transform: rotateY(360deg) rotateX(-6deg)}
    }

    /* Mini cards row */
    .mini-row{display:flex;gap:12px;flex-wrap:wrap}
    .mini-card{
      flex:1 1 120px;
      background:var(--card);
      border-radius:12px;padding:12px;
      box-shadow:var(--shadow-soft);display:flex;gap:12px;align-items:center;
      min-width:0;
    }
    .mini-icon{
      width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,#fff,#f6f7ff);
      display:grid;place-items:center;font-weight:700;color:var(--primary);box-shadow:0 8px 18px rgba(107,78,255,0.06);
      flex-shrink:0;
      font-size:18px;
    }
    .mini-body{font-size:var(--text-sm);color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .mini-value{font-weight:700;font-size:var(--text-base)}

    /* Insights chart */
    .insights{
      background:var(--card);border-radius:12px;padding:12px;box-shadow:var(--shadow-soft);
    }
    .insights h3{margin:0 0 8px 0;font-size:var(--text-base)}
    .chart-wrap{height:120px;padding:6px}

    /* Transactions list */
    .transactions{
      background:linear-gradient(180deg, rgba(255,255,255,0.9),#fff);
      border-radius:12px;padding:12px;box-shadow:var(--shadow-soft);
    }
    .transactions h3{margin:0 0 10px 0;font-size:var(--text-base)}
    .tx-list{display:flex;flex-direction:column;gap:8px}
    .tx{
      display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:10px;
      transition:transform .18s ease;
    }
    .tx:active, .tx:hover{transform:translateY(-4px)}
    .tx-left{display:flex;gap:12px;align-items:center;min-width:0}
    .cat-icon{
      width:44px;height:44px;border-radius:10px;background:#fff;display:grid;place-items:center;font-size:18px;
      box-shadow: 0 8px 20px rgba(21,24,60,0.04);flex-shrink:0;
    }
    .tx-meta{display:flex;flex-direction:column;min-width:0}
    .tx-meta div:first-child{font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .tx-amt{font-weight:700;white-space:nowrap}

    /* Right column (widgets) */
    .right{
      display:flex;flex-direction:column;gap:var(--gap);
      position:relative;
    }
    .goals-card{
      background:linear-gradient(180deg,#fff,#fbfbff);
      border-radius:12px;padding:14px;box-shadow:var(--shadow-soft);
    }
    .goal-bar{height:12px;background:#F1F6F8;border-radius:999px;overflow:hidden;margin-top:8px}
    .goal-bar > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#ff9f3b);width:40%}

    /* Floating add button */
    .add-btn{
      position:fixed;left:50%;transform:translateX(-50%);bottom:22px;
      width:min(92px,14vw);height:min(92px,14vw);border-radius:999px;background:linear-gradient(180deg,#fff,#FFF7EC);
      display:grid;place-items:center;font-size:34px;color:var(--primary);
      box-shadow: 0 22px 50px rgba(107,78,255,0.14);
      border: 6px solid rgba(255,255,255,0.6);
      cursor:pointer;
      transition:transform .15s ease, box-shadow .15s ease;
      z-index:60;
      touch-action:manipulation;
    }
    .add-btn:active{transform:translateX(-50%) scale(.96)}
    .add-inner{
      width:66%;height:66%;border-radius:999px;background:linear-gradient(180deg,var(--primary),#8A66FF);
      color:white;display:grid;place-items:center;font-weight:700;box-shadow:0 10px 24px rgba(107,78,255,0.18);
      transform-style:preserve-3d; perspective:900px; animation: floaty 3s ease-in-out infinite;
      font-size:clamp(18px,4vw,28px);
    }
    @keyframes floaty{
      0%{transform:translateY(0)}
      50%{transform:translateY(-8px)}
      100%{transform:translateY(0)}
    }

    /* Modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.35);display:none;align-items:center;justify-content:center;z-index:120}
    .modal-backdrop.active{display:flex}
    .modal-card{width:92%;max-width:520px;background:white;border-radius:12px;padding:16px;box-shadow:var(--shadow-lg)}
    .modal-row{display:flex;gap:8px;margin-bottom:10px}
    .modal-row input, .modal-row select, .modal-row textarea{flex:1;padding:10px;border-radius:8px;border:1px solid #eee;font-size:14px}

    .modal-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:8px}
    .btn{padding:8px 12px;border-radius:8px;border:0;cursor:pointer}
    .btn.primary{background:var(--primary);color:white}
    .btn.ghost{background:transparent;border:1px solid #ddd}

    /* Responsive breakpoints */
    @media (max-width:1100px){
      .container{grid-template-columns: 1fr 320px}
    }
    @media (max-width:900px){
      .container{grid-template-columns: 1fr; gap:16px}
      .right{order:2}
      .main{order:1}
      header{flex-direction:row;align-items:center;justify-content:space-between}
      .add-btn{left:86%;transform:translateX(0)}
      .chart-wrap{height:140px}
    }
    @media (max-width:520px){
      body{padding:14px}
      .balance-card{flex-direction:row;gap:10px;padding:12px;min-height:72px}
      .coin-wrap{width:74px;height:74px}
      .coin{border:5px solid rgba(255,255,255,0.12)}
      .mini-card{padding:10px}
      .transactions{padding:10px}
      .insights{padding:10px}
      .avatar-3d{display:flex;align-items:center;justify-content:center}
      .greeting h1{font-size:16px}
      .add-btn{width:74px;height:74px;left:78%;transform:translateX(0);bottom:18px}
      .chart-wrap{height:120px}
    }

    /* Accessibility - respect reduced motion */
    @media (prefers-reduced-motion: reduce){
      .coin, .add-inner{animation:none !important}
      *{transition:none !important}
    }

    /* small utilities */
    a{color:var(--primary);text-decoration:none}
    button{font-family:inherit}
  </style>
</head>
<body>
  <div class="outer">
    <div class="container" role="main" aria-label="Student budgeting dashboard">
      <header>
        <div class="greeting" style="min-width:0">
          <div style="min-width:0">
            <h1 title="Welcome">Hi, Vinay üëã</h1>
            <p>Track your expenses and stay on budget!</p>
          </div>
        </div>
        <div class="avatar-3d" title="Student avatar">
          <div class="face">VM</div>
        </div>
      </header>

      <main class="main" aria-live="polite">
        <!-- Balance Card -->
        <section class="balance-card" aria-label="Total balance">
          <div class="balance-left">
            <p class="small-label">Total Balance</p>
            <p class="big-amount" id="totalBalance">‚Çπ0.00</p>
            <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
              <div class="progress" aria-hidden="true"><i id="budgetProgressBar"></i></div>
              <div style="font-size:var(--text-sm);color:var(--muted)"><span id="budgetPercent">0%</span> used</div>
            </div>
            <p style="margin-top:10px;color:var(--muted);font-size:var(--text-sm)" id="balanceHint">Add transactions to see insights.</p>
          </div>

          <!-- 3D coin -->
          <div class="coin-wrap" aria-hidden="true">
            <div class="coin" title="Rotating coin"></div>
          </div>
        </section>

        <!-- Mini cards -->
        <section class="mini-row" aria-label="Overview">
          <div class="mini-card">
            <div class="mini-icon" aria-hidden="true">üçΩÔ∏è</div>
            <div style="min-width:0">
              <div class="mini-body">Spent Today</div>
              <div class="mini-value" id="spentToday">‚Çπ0</div>
            </div>
          </div>
          <div class="mini-card">
            <div class="mini-icon" aria-hidden="true">üìÖ</div>
            <div style="min-width:0">
              <div class="mini-body">This Month</div>
              <div class="mini-value" id="thisMonth">‚Çπ0</div>
            </div>
          </div>
          <div class="mini-card">
            <div class="mini-icon" aria-hidden="true">üí∞</div>
            <div style="min-width:0">
              <div class="mini-body">Remaining</div>
              <div class="mini-value" id="remaining">‚Çπ0</div>
            </div>
          </div>
        </section>

        <!-- Insights + transactions -->
        <section style="display:grid;grid-template-columns:1fr;gap:12px">
          <div class="insights" aria-label="Spending trend">
            <h3>üìà Spending Trend (Last 7 days)</h3>
            <div class="chart-wrap">
              <canvas id="trendChart" aria-label="Spending trend chart"></canvas>
            </div>
            <div style="margin-top:6px;text-align:right">
              <a href="#" id="viewInsights" style="font-weight:600;font-size:var(--text-sm)">View Full Insights ‚Üí</a>
            </div>
          </div>

          <div class="transactions" aria-label="Recent transactions">
            <h3>üßæ Recent Transactions</h3>
            <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px">
              <button id="btnAddTx" class="btn primary" title="Add expense/income">Add</button>
              <button id="btnBudget" class="btn ghost" title="Set monthly budget">Monthly Budget</button>
              <button id="btnGoal" class="btn ghost" title="Create savings goal">New Goal</button>
              <button id="btnClearData" class="btn ghost" title="Clear demo data">Reset</button>
            </div>
            <div class="tx-list" id="txList" role="list">
              <!-- transactions will be injected here -->
            </div>
          </div>
        </section>
      </main>

      <!-- Right column -->
      <aside class="right" aria-label="Side widgets">
        <div class="goals-card" aria-label="Savings goal widget">
          <h3>üéØ Savings Goals</h3>
          <div id="goalsList" style="display:flex;flex-direction:column;gap:10px;margin-top:8px">
            <!-- goals injected -->
          </div>
          <p style="margin-top:10px;color:var(--muted);font-size:var(--text-sm)">Use goals to set aside money for things you care about.</p>
        </div>

        <div class="goals-card" aria-label="Quick budgeting tips">
          <h3>Quick Tips</h3>
          <ul style="margin:8px 0 0 18px;color:var(--muted);font-size:var(--text-sm)">
            <li>Try a small weekly meal plan to cut food costs.</li>
            <li>Use public transport passes ‚Äî cheaper long-term.</li>
            <li>Pause subscriptions you don't use.</li>
          </ul>
        </div>
      </aside>
    </div>
  </div>

  <!-- Floating Add Button -->
  <button class="add-btn" title="Add expense" aria-label="Add expense" id="fabAdd">
    <div class="add-inner" aria-hidden="true">+</div>
  </button>

  <!-- Modal backdrop (reused for different modals) -->
  <div id="modalBackdrop" class="modal-backdrop" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div id="modalBody"></div>
    </div>
  </div>

  <script>
    /*************************************************************
     * Frontend-only Student Budgeting App
     * - Save data in localStorage
     * - Add transactions (income/expense)
     * - Set monthly budget
     * - Create savings goals & deposit to them
     * - Update UI & Chart (last 7 days)
     *************************************************************/

    // Helpers
    const $ = (sel, ctx = document) => ctx.querySelector(sel);
    const el = (tag, props = {}, ...children) => {
      const d = document.createElement(tag);
      for (const k in props) {
        if (k === 'class') d.className = props[k];
        else if (k === 'text') d.textContent = props[k];
        else if (k.startsWith('on') && typeof props[k] === 'function') d.addEventListener(k.slice(2).toLowerCase(), props[k]);
        else d.setAttribute(k, props[k]);
      }
      children.flat().forEach(c => { if (c == null) return; d.appendChild(typeof c === 'string' ? document.createTextNode(c) : c); });
      return d;
    };

    // Local storage key
    const STORAGE_KEY = 'student_budget_v1';

    // Default demo state
    const defaultState = {
      totalBalance: 12450,
      transactions: [
        // sample transactions: {id, title, amount, category, dateISO, note}
        { id: 't1', title: 'McDonalds', amount: -180, category: 'Food', dateISO: todayISO(), note: '' },
        { id: 't2', title: 'Bus Pass', amount: -60, category: 'Travel', dateISO: todayISO(), note: '' },
        { id: 't3', title: 'Lab Record', amount: -150, category: 'College', dateISO: todayISOOffset(-1), note: '' },
        { id: 't4', title: 'Caf√© Latte', amount: -110, category: 'Snacks', dateISO: todayISOOffset(-2), note: '' },
        { id: 't5', title: 'Part-time Pay', amount: 4000, category: 'Income', dateISO: todayISOOffset(-8), note: 'Monthly stipend' }
      ],
      budgets: [ // per month budgets (YYYY-MM)
        { id: 'b1', month: monthKey(new Date()), limit: 12000 } // current month budget
      ],
      goals: [ // savings goals
        { id: 'g1', name: 'Trip Fund', target: 12000, saved: 5200 }
      ],
      categories: ['Food','Travel','College','Snacks','Income','Shopping','Utilities']
    };

    // State (loaded from storage or defaults)
    let state = loadState();

    // Elements
    const totalBalanceEl = $('#totalBalance');
    const spentTodayEl = $('#spentToday');
    const thisMonthEl = $('#thisMonth');
    const remainingEl = $('#remaining');
    const txListEl = $('#txList');
    const goalsListEl = $('#goalsList');
    const budgetProgressBar = $('#budgetProgressBar');
    const budgetPercentEl = $('#budgetPercent');
    const balanceHintEl = $('#balanceHint');

    // Chart
    let trendChart = null;
    const ctx = document.getElementById('trendChart').getContext('2d');

    // Modal utilities
    const modalBackdrop = $('#modalBackdrop');
    const modalBody = $('#modalBody');

    function openModal(contentNode) {
      modalBody.innerHTML = '';
      modalBody.appendChild(contentNode);
      modalBackdrop.classList.add('active');
      modalBackdrop.setAttribute('aria-hidden', 'false');
      // focus first input if any
      const firstInput = modalBody.querySelector('input,select,textarea,button');
      if (firstInput) firstInput.focus();
    }
    function closeModal() {
      modalBackdrop.classList.remove('active');
      modalBackdrop.setAttribute('aria-hidden', 'true');
    }
    modalBackdrop.addEventListener('click', (e) => {
      if (e.target === modalBackdrop) closeModal();
    });

    /* ----------------- Persistence ----------------- */
    function saveState() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      } catch (e) {
        console.warn('Unable to save state', e);
      }
    }
    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) return JSON.parse(raw);
      } catch (e) { /* ignore */ }
      // otherwise return clone of default
      return JSON.parse(JSON.stringify(defaultState));
    }

    // Utilities for dates/keys
    function monthKey(d) {
      const y = d.getFullYear();
      const m = (d.getMonth() + 1).toString().padStart(2,'0');
      return `${y}-${m}`;
    }
    function formatCurrency(n){
      const sign = n < 0 ? '-' : '';
      return sign + '‚Çπ' + Math.abs(n).toLocaleString('en-IN', {minimumFractionDigits: 0, maximumFractionDigits: 2});
    }
    function todayISO() {
      const d = new Date();
      return d.toISOString().slice(0,10);
    }
    function todayISOOffset(offsetDays) {
      const d = new Date();
      d.setDate(d.getDate() + (offsetDays || 0));
      return d.toISOString().slice(0,10);
    }
    function uid(prefix='id'){ return prefix + Math.random().toString(36).slice(2,9); }

    /* ----------------- Rendering ----------------- */
    function renderAll() {
      renderSummary();
      renderTransactions();
      renderGoals();
      renderChart();
    }

    function computeTotals() {
      const totals = {
        balance: 0,
        spentToday: 0,
        thisMonthSpent: 0,
        budgetLimit: null,
      };
      // initial balance from state.totalBalance plus all transactions aggregated
      // We'll treat state.totalBalance as starting balance; transactions then modify it.
      totals.balance = state.totalBalance + state.transactions.reduce((s,t)=>s + Number(t.amount), 0);

      // spent today
      const today = todayISO();
      totals.spentToday = state.transactions.filter(t => t.dateISO === today && t.amount < 0).reduce((s,t)=> s + Math.abs(t.amount), 0);

      // this month spent
      const currentMonth = monthKey(new Date());
      totals.thisMonthSpent = state.transactions.filter(t => monthKey(new Date(t.dateISO)) === currentMonth && t.amount < 0).reduce((s,t)=> s + Math.abs(t.amount), 0);

      // find budget for current month
      const budgetObj = state.budgets.find(b => b.month === currentMonth);
      totals.budgetLimit = budgetObj ? budgetObj.limit : null;

      return totals;
    }

    function renderSummary(){
      const totals = computeTotals();
      totalBalanceEl.textContent = formatCurrency(totals.balance);
      spentTodayEl.textContent = formatCurrency(totals.spentToday);
      thisMonthEl.textContent = formatCurrency(totals.thisMonthSpent);
      // remaining = budget limit - spent; if no budget show estimate remaining based on default
      if (totals.budgetLimit) {
        const remaining = Math.max(0, totals.budgetLimit - totals.thisMonthSpent);
        remainingEl.textContent = formatCurrency(remaining);
        const pct = Math.round((totals.thisMonthSpent / totals.budgetLimit) * 100);
        const safePct = Math.min(100, Math.max(0, pct || 0));
        budgetProgressBar.style.width = safePct + '%';
        budgetPercentEl.textContent = safePct + '%';
        balanceHintEl.textContent = `Budget for ${totals.budgetLimit ? 'this month' : ''}`;
      } else {
        remainingEl.textContent = formatCurrency(Math.max(0, totals.balance));
        budgetProgressBar.style.width = '0%';
        budgetPercentEl.textContent = '0%';
        balanceHintEl.textContent = `No monthly budget set. Click "Monthly Budget" to set one.`;
      }
    }

    function renderTransactions(){
      txListEl.innerHTML = '';
      // show the most recent 12 transactions (newest first)
      const txs = [...state.transactions].sort((a,b) => new Date(b.dateISO) - new Date(a.dateISO)).slice(0,12);
      if (txs.length === 0) {
        txListEl.appendChild(el('div', { class: 'tx' }, 'No transactions yet ‚Äî add your first expense or income.'));
        return;
      }
      txs.forEach(t => {
        const row = el('div', { class: 'tx', role: 'listitem' },
          el('div', { class: 'tx-left' },
            el('div', { class: 'cat-icon' }, t.category ? t.category[0] : 'üí∏'),
            el('div', { class: 'tx-meta' },
              el('div', {}, t.title),
              el('div', { style: 'font-size:var(--text-sm);color:var(--muted)' }, `${t.category} ‚Äî ${t.dateISO}`)
            )
          ),
          el('div', { class: 'tx-amt', style: `color:${t.amount < 0 ? '#FF5C5C' : '#3DDC84'}` }, t.amount < 0 ? `-‚Çπ${Math.abs(t.amount)}` : `‚Çπ${t.amount}`)
        );

        // actions: quick edit/delete and deposit to goal for positive amounts
        const actions = el('div', { style: 'display:flex;gap:8px;align-items:center;margin-left:12px' });
        const btnDel = el('button', { class: 'btn ghost', title: 'Delete', onClick: () => { if(confirm('Delete transaction?')) { removeTransaction(t.id); } } }, 'Delete');
        const btnEdit = el('button', { class: 'btn ghost', title: 'Edit', onClick: () => { openEditTransactionModal(t.id); } }, 'Edit');
        actions.appendChild(btnEdit);
        actions.appendChild(btnDel);
        // append actions to row by wrapping existing row so layout remains
        const wrapper = el('div', { style: 'display:flex;justify-content:space-between;align-items:center' }, row, actions);
        txListEl.appendChild(wrapper);
      });
    }

    function renderGoals(){
      goalsListEl.innerHTML = '';
      if (!state.goals || state.goals.length === 0) {
        goalsListEl.appendChild(el('div', { style: 'color:var(--muted);font-size:var(--text-sm)' }, 'No goals yet ‚Äî create a savings goal.'));
        return;
      }
      state.goals.forEach(g => {
        const pct = Math.round((g.saved / g.target) * 100);
        const safePct = Math.min(100, Math.max(0, pct || 0));
        const node = el('div', {},
          el('div', { style: 'display:flex;justify-content:space-between;align-items:center' },
            el('div', { style: 'font-weight:700' }, g.name),
            el('div', { style: 'font-weight:700;color:var(--primary)' }, `${safePct}%`)
          ),
          el('div', { style: 'font-size:var(--text-sm);color:var(--muted)' }, `Saved: ‚Çπ${g.saved.toLocaleString()} / ‚Çπ${g.target.toLocaleString()}`),
          el('div', { class: 'goal-bar', style: 'margin-top:8px' }, el('i', { style: `width:${safePct}%` })),
          el('div', { style: 'display:flex;gap:8px;margin-top:8px' },
            el('button', { class: 'btn ghost', onClick: () => openDepositToGoalModal(g.id) }, 'Add to Goal'),
            el('button', { class: 'btn ghost', onClick: () => { if(confirm('Delete goal?')) { state.goals = state.goals.filter(x=>x.id!==g.id); saveState(); renderAll(); } } }, 'Delete')
          )
        );
        goalsListEl.appendChild(node);
      });
    }

    /* ----------------- Chart (last 7 days) ----------------- */
    function aggregateLast7Days(){
      const labels = [];
      const values = [];
      for (let i = 6; i >= 0; i--) {
        const d = new Date();
        d.setDate(d.getDate() - i);
        const key = d.toISOString().slice(0,10);
        labels.push(d.toLocaleDateString(undefined, { weekday: 'short' }));
        const sum = state.transactions.filter(t => t.dateISO === key && t.amount < 0).reduce((s,t) => s + Math.abs(t.amount), 0);
        values.push(sum);
      }
      return { labels, values };
    }

    function renderChart(){
      const agg = aggregateLast7Days();
      // destroy previous
      if (trendChart) trendChart.destroy();
      const gradient = ctx.createLinearGradient(0,0,0,240);
      gradient.addColorStop(0, 'rgba(107,78,255,0.28)');
      gradient.addColorStop(1, 'rgba(107,78,255,0.04)');

      trendChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: agg.labels,
          datasets: [{
            label: 'Spent',
            data: agg.values,
            fill: true,
            backgroundColor: gradient,
            borderColor: '#6B4EFF',
            tension: 0.36,
            pointRadius: 0,
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: {
            x: { grid: { display:false }, ticks:{color:'#9aa0b4'} },
            y: { display:false }
          },
          interaction: { intersect: false }
        }
      });
    }

    /* ----------------- Actions: Add Transaction / Budget / Goal ----------------- */

    // Open "Add Transaction" modal
    function openAddTransactionModal(defaultType = 'expense') {
      const modalNode = el('div', {},
        el('h3', { id: 'modalTitle' }, 'Add Transaction'),
        el('div', { class: 'modal-row' },
          el('input', { placeholder: 'Title (e.g., Coffee)', id: 'txTitle' })
        ),
        el('div', { class: 'modal-row' },
          el('select', { id: 'txCategory' }, ...state.categories.map(c=> el('option', { value: c }, c)))
        ),
        el('div', { class: 'modal-row' },
          el('input', { id: 'txAmount', type: 'number', min: '0', placeholder: 'Amount (positive number)' })
        ),
        el('div', { class: 'modal-row' },
          el('input', { id: 'txDate', type: 'date', value: todayISO() }),
          el('select', { id: 'txType' },
            el('option', { value: 'expense' }, 'Expense'),
            el('option', { value: 'income' }, 'Income')
          )
        ),
        el('div', { class: 'modal-row' },
          el('textarea', { id: 'txNote', placeholder: 'Note (optional)' , rows: 3})
        ),
        el('div', { class: 'modal-actions' },
          el('button', { class: 'btn ghost', onClick: closeModal }, 'Cancel'),
          el('button', { class: 'btn primary', onClick: () => {
            const title = $('#txTitle', modalBody).value.trim() || 'Untitled';
            const amount = parseFloat($('#txAmount', modalBody).value || '0');
            const dateISO = $('#txDate', modalBody).value;
            const type = $('#txType', modalBody).value;
            const note = $('#txNote', modalBody).value.trim();
            const category = $('#txCategory', modalBody).value || 'Other';
            if (!amount || isNaN(amount) || amount <= 0) { alert('Enter a valid amount'); return; }
            const signed = type === 'expense' ? -Math.abs(amount) : Math.abs(amount);
            const tx = { id: uid('t'), title, amount: signed, category, dateISO, note };
            state.transactions.push(tx);
            saveState();
            closeModal();
            renderAll();
          } }, 'Save')
        )
      );
      openModal(modalNode);
      // set type
      $('#txType', modalBody).value = defaultType;
    }

    // Edit existing transaction
    function openEditTransactionModal(txId) {
      const tx = state.transactions.find(t => t.id === txId);
      if (!tx) return;
      const modalNode = el('div', {},
        el('h3', { id: 'modalTitle' }, 'Edit Transaction'),
        el('div', { class: 'modal-row' },
          el('input', { placeholder: 'Title', id: 'txTitle', value: tx.title })
        ),
        el('div', { class: 'modal-row' },
          el('select', { id: 'txCategory' }, ...state.categories.map(c=> el('option', { value: c, selected: c === tx.category }, c)))
        ),
        el('div', { class: 'modal-row' },
          el('input', { id: 'txAmount', type: 'number', min: '0', value: Math.abs(tx.amount) })
        ),
        el('div', { class: 'modal-row' },
          el('input', { id: 'txDate', type: 'date', value: tx.dateISO }),
          el('select', { id: 'txType' },
            el('option', { value: 'expense', selected: tx.amount < 0 }, 'Expense'),
            el('option', { value: 'income', selected: tx.amount >= 0 }, 'Income')
          )
        ),
        el('div', { class: 'modal-row' },
          el('textarea', { id: 'txNote', rows: 3 }, tx.note || '')
        ),
        el('div', { class: 'modal-actions' },
          el('button', { class: 'btn ghost', onClick: closeModal }, 'Cancel'),
          el('button', { class: 'btn primary', onClick: () => {
            const title = $('#txTitle', modalBody).value.trim() || 'Untitled';
            const amount = parseFloat($('#txAmount', modalBody).value || '0');
            const dateISO = $('#txDate', modalBody).value;
            const type = $('#txType', modalBody).value;
            const note = $('#txNote', modalBody).value.trim();
            const category = $('#txCategory', modalBody).value || 'Other';
            if (!amount || isNaN(amount) || amount <= 0) { alert('Enter a valid amount'); return; }
            tx.title = title;
            tx.amount = type === 'expense' ? -Math.abs(amount) : Math.abs(amount);
            tx.dateISO = dateISO;
            tx.note = note;
            tx.category = category;
            saveState();
            closeModal();
            renderAll();
          } }, 'Save')
        )
      );
      openModal(modalNode);
    }

    // Remove transaction by id
    function removeTransaction(id) {
      state.transactions = state.transactions.filter(t => t.id !== id);
      saveState();
      renderAll();
    }

    // Monthly Budget modal
    function openBudgetModal() {
      // determine current month
      const curMonth = monthKey(new Date());
      const existing = state.budgets.find(b => b.month === curMonth);
      const modalNode = el('div', {},
        el('h3', { id: 'modalTitle' }, 'Set Monthly Budget'),
        el('div', { class: 'modal-row' },
          el('input', { id: 'budgetLimit', type: 'number', placeholder: 'Budget amount (‚Çπ)', value: existing ? existing.limit : '' })
        ),
        el('div', { class: 'modal-actions' },
          el('button', { class: 'btn ghost', onClick: closeModal }, 'Cancel'),
          el('button', { class: 'btn primary', onClick: () => {
            const val = parseFloat($('#budgetLimit', modalBody).value || '0');
            if (!val || isNaN(val) || val <= 0) { alert('Enter a valid budget'); return; }
            if (existing) {
              existing.limit = val;
            } else {
              state.budgets.push({ id: uid('b'), month: curMonth, limit: val });
            }
            saveState();
            closeModal();
            renderAll();
          } }, 'Save')
        )
      );
      openModal(modalNode);
    }

    // Create savings goal modal
    function openNewGoalModal() {
      const modalNode = el('div', {},
        el('h3', { id: 'modalTitle' }, 'New Savings Goal'),
        el('div', { class: 'modal-row' },
          el('input', { id: 'goalName', placeholder: 'Goal name (e.g., Trip)' })
        ),
        el('div', { class: 'modal-row' },
          el('input', { id: 'goalTarget', type: 'number', placeholder: 'Target amount (‚Çπ)' })
        ),
        el('div', { class: 'modal-actions' },
          el('button', { class: 'btn ghost', onClick: closeModal }, 'Cancel'),
          el('button', { class: 'btn primary', onClick: () => {
            const name = $('#goalName', modalBody).value.trim();
            const target = parseFloat($('#goalTarget', modalBody).value || '0');
            if (!name) { alert('Enter a name'); return; }
            if (!target || isNaN(target) || target <= 0) { alert('Enter a valid target'); return; }
            state.goals.push({ id: uid('g'), name, target, saved: 0 });
            saveState();
            closeModal();
            renderAll();
          } }, 'Create')
        )
      );
      openModal(modalNode);
    }

    // Deposit to goal modal
    function openDepositToGoalModal(goalId) {
      const goal = state.goals.find(g => g.id === goalId);
      if (!goal) return;
      const modalNode = el('div', {},
        el('h3', { id: 'modalTitle' }, `Add to ${goal.name}`),
        el('div', { class: 'modal-row' },
          el('input', { id: 'depositAmount', type: 'number', placeholder: 'Amount (‚Çπ)' })
        ),
        el('div', { class: 'modal-row' },
          el('input', { id: 'depositDate', type: 'date', value: todayISO() }),
          el('select', { id: 'depositUse' },
            el('option', { value: 'from_balance' }, 'From Balance'),
            el('option', { value: 'from_transaction' }, 'Record as Transaction')
          )
        ),
        el('div', { class: 'modal-actions' },
          el('button', { class: 'btn ghost', onClick: closeModal }, 'Cancel'),
          el('button', { class: 'btn primary', onClick: () => {
            const amount = parseFloat($('#depositAmount', modalBody).value || '0');
            const dateISO = $('#depositDate', modalBody).value;
            const use = $('#depositUse', modalBody).value;
            if (!amount || isNaN(amount) || amount <= 0) { alert('Enter a valid amount'); return; }
            // deposit into goal
            goal.saved = Number(goal.saved) + amount;
            // optionally record as expense transaction so totals update
            if (use === 'from_transaction') {
              const tx = { id: uid('t'), title: `Saved to ${goal.name}`, amount: -Math.abs(amount), category: 'Savings', dateISO, note: `Goal deposit` };
              state.transactions.push(tx);
            }
            saveState();
            closeModal();
            renderAll();
          } }, 'Add')
        )
      );
      openModal(modalNode);
    }

    /* ----------------- Reset / Demo helpers ----------------- */
    function resetData() {
      if (!confirm('Reset all data to demo defaults? This cannot be undone.')) return;
      state = JSON.parse(JSON.stringify(defaultState));
      saveState();
      renderAll();
    }

    /* ----------------- Event bindings ----------------- */
    $('#fabAdd').addEventListener('click', () => openAddTransactionModal('expense'));
    $('#btnAddTx').addEventListener('click', () => openAddTransactionModal('expense'));
    $('#btnBudget').addEventListener('click', openBudgetModal);
    $('#btnGoal').addEventListener('click', openNewGoalModal);
    $('#btnClearData').addEventListener('click', resetData);

    // view insights link scrolls to chart (simple action)
    $('#viewInsights').addEventListener('click', (e) => { e.preventDefault(); document.getElementById('trendChart').scrollIntoView({ behavior: 'smooth' }); });

    // keyboard shortcut: 'n' to add new transaction
    window.addEventListener('keydown', (e) => {
      if (e.key === 'n' && !modalBackdrop.classList.contains('active')) {
        openAddTransactionModal();
      }
    });

    /* ----------------- Initialization ----------------- */
    function boot() {
      // Ensure arrays exist
      state.transactions = Array.isArray(state.transactions) ? state.transactions : [];
      state.budgets = Array.isArray(state.budgets) ? state.budgets : [];
      state.goals = Array.isArray(state.goals) ? state.goals : [];
      state.categories = Array.isArray(state.categories) ? state.categories : ['Food','Travel','Income'];

      // initial render
      renderAll();

      // ensure chart recalculates on resize/orientation change
      let t;
      window.addEventListener('resize', () => { clearTimeout(t); t = setTimeout(renderChart, 160); });
      window.addEventListener('orientationchange', () => setTimeout(renderChart, 180));
    }

    // Run
    boot();

  </script>
</body>
</html>
