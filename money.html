<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Budget â€” Expense Tracker</title>
  <meta name="description" content="Budget page with Add Money, Salary, Expenses â€” frontend only" />
  <style>
    :root{
      --bg:#071023;
      --card:#0f1624;
      --muted:#94a3b8;
      --text:#e6eef8;
      --accent:#7c3aed;
      --accent-2:#ffb443;
      --success:#10b981;
      --danger:#ef4444;
      --glass: rgba(255,255,255,0.03);
      --radius:12px;
      --container:1100px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
      background:linear-gradient(180deg,var(--bg), #071427);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      padding:28px;
    }

    .wrap{max-width:var(--container);margin:0 auto}
    header{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:18px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#8A66FF);display:grid;place-items:center;font-weight:800}
    h1{font-size:20px;margin:0}
    .small{color:var(--muted);font-size:13px}

    main{display:grid;grid-template-columns:1fr 360px;gap:18px}
    @media(max-width:980px){ main{grid-template-columns:1fr} }

    /* left column */
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    .budget-top{display:flex;align-items:center;gap:16px}
    .coin{width:72px;height:72px;border-radius:50%;display:grid;place-items:center;font-weight:900;color:#6b3a18;background:linear-gradient(180deg,#ffd549,#ffb443);box-shadow:0 14px 36px rgba(255,180,60,0.12);animation:spin 5s linear infinite}
    @keyframes spin{0%{transform:rotateY(0) rotateX(-6deg)}100%{transform:rotateY(360deg) rotateX(-6deg)}}
    .budget-info{flex:1}
    .budget-amount{font-weight:800;font-size:28px}
    .budget-sub{color:var(--muted);margin-top:6px}

    .actions{display:flex;gap:10px;margin-top:12px}
    .btn{padding:10px 12px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--accent),#8A66FF);color:white;font-weight:700;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
    .btn.success{background:linear-gradient(90deg,#34d399,#10b981)}
    .muted{color:var(--muted)}

    /* progress */
    .progress-row{display:flex;gap:12px;align-items:center;margin-top:14px}
    svg.progress{width:84px;height:84px;transform:rotate(-90deg)}
    .percent{font-weight:800;font-size:18px}

    /* transactions */
    .tx-list{margin-top:14px;display:flex;flex-direction:column;gap:8px}
    .tx{display:flex;align-items:center;justify-content:space-between;padding:10px;border-radius:10px;background:rgba(255,255,255,0.01);border:1px solid rgba(255,255,255,0.02)}
    .tx-left{display:flex;align-items:center;gap:12px}
    .tx-icon{width:44px;height:44px;border-radius:10px;display:grid;place-items:center;background:rgba(255,255,255,0.02)}
    .tx-meta{min-width:0}
    .tx-title{font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .tx-sub{color:var(--muted);font-size:13px}
    .tx-amt{font-weight:800}

    /* right column */
    .right{display:flex;flex-direction:column;gap:12px}
    .small-card{padding:12px;border-radius:10px;background:rgba(255,255,255,0.01);border:1px solid rgba(255,255,255,0.02)}

    .form-row{display:flex;flex-direction:column;gap:8px;margin-top:10px}
    input,select{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.05);background:transparent;color:var(--text)}

    /* modal */
    .modal-backdrop{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.6);z-index:80}
    .modal{width:100%;max-width:520px;background:var(--card);padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    .modal h3{margin:0 0 8px 0}
    .modal .row{display:flex;gap:8px}
    .modal .row .btn{flex:1}

    .mini{font-size:13px;color:var(--muted)}
    .gap{height:12px}

    /* small helpers */
    .right-align{display:flex;justify-content:flex-end}
    .icon-btn{background:transparent;border:0;color:var(--muted);cursor:pointer;font-size:14px}
    .trash{color:var(--danger)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">ET</div>
        <div>
          <h1>Expense Tracker â€” Budget</h1>
          <div class="small">Manage money, salary, and budgets</div>
        </div>
      </div>

      <div style="display:flex;gap:10px;align-items:center">
        <button class="btn ghost" id="openSalary">Add Salary</button>
        <button class="btn ghost" id="openTopup">Add Money</button>
        <button class="btn" id="openExpense">Add Expense</button>
      </div>
    </header>

    <main>
      <!-- LEFT -->
      <section class="card">
        <div class="budget-top">
          <div class="coin" title="Rupee coin">â‚¹</div>
          <div class="budget-info">
            <div class="budget-amount" id="monthlyBudget">â‚¹ 0</div>
            <div class="budget-sub" id="budgetSub">Monthly budget and summary</div>

            <div class="progress-row">
              <svg class="progress" viewBox="0 0 100 100" aria-hidden>
                <circle cx="50" cy="50" r="40" stroke="#11161f" stroke-width="12" fill="none"></circle>
                <circle id="progressCircle" cx="50" cy="50" r="40" stroke="#8A66FF" stroke-width="12" stroke-linecap="round" fill="none" stroke-dasharray="251.2" stroke-dashoffset="251.2"></circle>
              </svg>
              <div>
                <div class="percent" id="percentUsed">0%</div>
                <div class="mini" id="remainingText">Remaining: â‚¹0</div>
              </div>
            </div>
          </div>
        </div>

        <div class="gap"></div>

        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="mini">Transactions</div>
          <div class="mini">Click an item to edit / delete</div>
        </div>

        <div class="tx-list" id="txList" role="list" aria-live="polite">
          <!-- transactions render here -->
        </div>
      </section>

      <!-- RIGHT -->
      <aside class="right">
        <div class="small-card">
          <div class="mini">Set Monthly Budget</div>
          <div style="display:flex;gap:8px;margin-top:8px;">
            <input type="number" id="budgetInput" placeholder="Enter monthly budget (â‚¹)" />
            <button class="btn" id="setBudgetBtn">Set</button>
          </div>
          <div class="mini" style="margin-top:8px">Current monthly budget updates the progress ring.</div>
        </div>

        <div class="small-card">
          <div class="mini">Quick Totals</div>
          <div style="display:flex;justify-content:space-between;margin-top:8px">
            <div>
              <div class="mini">Total Income</div>
              <div id="totalIncome" style="font-weight:800">â‚¹0</div>
            </div>
            <div>
              <div class="mini">Total Expenses</div>
              <div id="totalSpent" style="font-weight:800">â‚¹0</div>
            </div>
          </div>
        </div>

        <div class="small-card">
          <div class="mini">Actions</div>
          <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
            <button class="btn" id="clearAll">Clear Transactions</button>
            <button class="btn ghost" id="exportBtn">Export (JSON)</button>
          </div>
        </div>
      </aside>
    </main>
  </div>

  <!-- MODALS -->
  <div class="modal-backdrop" id="modalBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <h3 id="modalTitle">Modal</h3>

      <div id="modalBody"></div>

      <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end">
        <button class="btn" id="modalSave">Save</button>
        <button class="btn ghost" id="modalCancel">Cancel</button>
      </div>
    </div>
  </div>

  <script>
    /*********************
     * Storage & State
     *********************/
    const STORAGE_KEY = 'budget_state_v1';
    let state = {
      monthlyBudget: 12000,
      transactions: [
        // sample: { id, type: 'income'|'expense', title, amount, category, date, note }
      ]
    };

    // load
    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(raw) state = JSON.parse(raw);
      }catch(e){}
    }
    function saveState(){
      try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }catch(e){}
    }

    loadState();

    /*********************
     * DOM refs
     *********************/
    const monthlyBudgetEl = document.getElementById('monthlyBudget');
    const budgetSubEl = document.getElementById('budgetSub');
    const percentUsedEl = document.getElementById('percentUsed');
    const remainingTextEl = document.getElementById('remainingText');
    const progressCircle = document.getElementById('progressCircle');
    const txListEl = document.getElementById('txList');
    const budgetInput = document.getElementById('budgetInput');
    const setBudgetBtn = document.getElementById('setBudgetBtn');
    const totalIncomeEl = document.getElementById('totalIncome');
    const totalSpentEl = document.getElementById('totalSpent');

    const openTopupBtn = document.getElementById('openTopup');
    const openSalaryBtn = document.getElementById('openSalary');
    const openExpenseBtn = document.getElementById('openExpense');
    const clearAllBtn = document.getElementById('clearAll');
    const exportBtn = document.getElementById('exportBtn');

    const modalBackdrop = document.getElementById('modalBackdrop');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');
    const modalSave = document.getElementById('modalSave');
    const modalCancel = document.getElementById('modalCancel');

    /*********************
     * Utils
     *********************/
    function genId(){ return 'i'+Math.random().toString(36).slice(2,9); }
    function fmtINR(n){ return 'â‚¹' + Number(n).toLocaleString('en-IN', {maximumFractionDigits:2}); }
    function todayISO(){ return new Date().toISOString().slice(0,10); }

    /*********************
     * Render
     *********************/
    function renderAll(){
      // budget
      monthlyBudgetEl.textContent = fmtINR(state.monthlyBudget);
      // compute totals for current month (simple: consider all)
      const totalIncome = state.transactions.filter(t=>t.type==='income').reduce((s,t)=>s+Number(t.amount),0);
      const totalExpenses = state.transactions.filter(t=>t.type==='expense').reduce((s,t)=>s+Math.abs(Number(t.amount)),0);
      const used = totalExpenses;
      const remaining = state.monthlyBudget - used;
      const percentUsed = state.monthlyBudget > 0 ? Math.round((used/state.monthlyBudget)*100) : 0;

      percentUsedEl.textContent = percentUsed + '%';
      remainingTextEl.textContent = `Remaining: ${fmtINR(Math.max(0, remaining))}`;
      budgetSubEl.textContent = `You've spent ${fmtINR(used)} of ${fmtINR(state.monthlyBudget)} this month`;

      // progress circle (circumference ~ 251.2)
      const C = 2*Math.PI*40;
      const offset = C * (1 - Math.min(100, Math.max(0, percentUsed))/100);
      progressCircle.style.strokeDashoffset = offset.toFixed(3);
      // color warning
      if(percentUsed >= 90) progressCircle.style.stroke = 'var(--danger)';
      else if(percentUsed >= 70) progressCircle.style.stroke = 'orange';
      else progressCircle.style.stroke = '#8A66FF';

      // totals
      totalIncomeEl.textContent = fmtINR(totalIncome);
      totalSpentEl.textContent = fmtINR(totalExpenses);

      // transactions list (most recent first)
      txListEl.innerHTML = '';
      const sorted = state.transactions.slice().sort((a,b)=> new Date(b.date) - new Date(a.date));
      if(sorted.length === 0){
        const p = document.createElement('div'); p.className='mini muted'; p.textContent='No transactions yet. Add income or expense.';
        txListEl.appendChild(p);
      }else{
        sorted.forEach(t=>{
          const row = document.createElement('div'); row.className='tx';
          const left = document.createElement('div'); left.className='tx-left';
          const icon = document.createElement('div'); icon.className='tx-icon'; icon.textContent = t.type==='income' ? 'ðŸ’¼' : 'ðŸ’¸';
          const meta = document.createElement('div'); meta.className='tx-meta';
          const title = document.createElement('div'); title.className='tx-title'; title.textContent = t.title;
          const sub = document.createElement('div'); sub.className='tx-sub'; sub.textContent = `${t.category || ''} â€¢ ${t.date} ${t.note? 'â€” ' + t.note: ''}`;
          meta.appendChild(title); meta.appendChild(sub);
          left.appendChild(icon); left.appendChild(meta);

          const right = document.createElement('div'); right.style.display='flex'; right.style.alignItems='center'; right.style.gap='10px';
          const amt = document.createElement('div'); amt.className='tx-amt'; amt.textContent = (t.type==='expense' ? '-' : '+') + fmtINR(Math.abs(t.amount));
          amt.style.color = t.type==='expense' ? 'var(--danger)' : 'var(--success)';

          const editBtn = document.createElement('button'); editBtn.className='icon-btn'; editBtn.title='Edit'; editBtn.innerHTML='âœï¸';
          const delBtn = document.createElement('button'); delBtn.className='icon-btn trash'; delBtn.title='Delete'; delBtn.innerHTML='ðŸ—‘ï¸';

          editBtn.addEventListener('click', ()=> openEditTransaction(t.id));
          delBtn.addEventListener('click', ()=> { if(confirm('Delete this transaction?')) { deleteTransaction(t.id); } });

          right.appendChild(amt); right.appendChild(editBtn); right.appendChild(delBtn);

          row.appendChild(left); row.appendChild(right);
          txListEl.appendChild(row);
        });
      }

      saveState();
    }

    /*********************
     * Actions: add / edit / delete
     *********************/
    // open modal helpers
    function openModal(title, bodyHTML, saveCallback){
      modalTitle.textContent = title;
      modalBody.innerHTML = bodyHTML;
      modalBackdrop.style.display = 'flex';
      modalBackdrop.setAttribute('aria-hidden','false');
      modalSave.onclick = ()=> {
        saveCallback();
        closeModal();
      };
      modalCancel.onclick = closeModal;
    }
    function closeModal(){
      modalBackdrop.style.display = 'none';
      modalBackdrop.setAttribute('aria-hidden','true');
      modalBody.innerHTML = '';
    }

    // Add Top-up money (treated as income)
    openTopupBtn.addEventListener('click', ()=>{
      openModal('Add Money (Top-up)', `
        <div class="form-row">
          <label class="mini">Title</label>
          <input id="mTitle" placeholder="Source (e.g., Wallet top-up)" />
          <label class="mini">Amount (â‚¹)</label>
          <input id="mAmt" type="number" placeholder="e.g., 500" />
          <label class="mini">Category</label>
          <input id="mCat" placeholder="e.g., Cash, Bank" />
          <label class="mini">Date</label>
          <input id="mDate" type="date" value="${todayISO()}" />
          <label class="mini">Note (optional)</label>
          <input id="mNote" placeholder="Note" />
        </div>
      `, ()=>{
        const title = document.getElementById('mTitle').value.trim() || 'Top-up';
        const amount = Number(document.getElementById('mAmt').value) || 0;
        if(!amount){ alert('Enter valid amount'); return; }
        const category = document.getElementById('mCat').value.trim() || 'Top-up';
        const date = document.getElementById('mDate').value || todayISO();
        const note = document.getElementById('mNote').value.trim();
        const tx = { id: genId(), type:'income', title, amount, category, date, note };
        state.transactions.push(tx);
        renderAll();
      });
    });

    // Add Salary (income, maybe larger)
    openSalaryBtn.addEventListener('click', ()=>{
      openModal('Add Salary', `
        <div class="form-row">
          <label class="mini">Employer / Source</label>
          <input id="sTitle" placeholder="Employer name" />
          <label class="mini">Amount (â‚¹)</label>
          <input id="sAmt" type="number" placeholder="e.g., 15000" />
          <label class="mini">Date</label>
          <input id="sDate" type="date" value="${todayISO()}" />
          <label class="mini">Note</label>
          <input id="sNote" placeholder="e.g., monthly salary" />
        </div>
      `, ()=>{
        const title = document.getElementById('sTitle').value.trim() || 'Salary';
        const amount = Number(document.getElementById('sAmt').value) || 0;
        if(!amount){ alert('Enter valid amount'); return; }
        const date = document.getElementById('sDate').value || todayISO();
        const note = document.getElementById('sNote').value.trim();
        const tx = { id: genId(), type:'income', title, amount, category:'Salary', date, note };
        state.transactions.push(tx);
        renderAll();
      });
    });

    // Add Expense
    openExpenseBtn.addEventListener('click', ()=>{
      openModal('Add Expense', `
        <div class="form-row">
          <label class="mini">Title</label>
          <input id="eTitle" placeholder="e.g., Lunch" />
          <label class="mini">Amount (â‚¹)</label>
          <input id="eAmt" type="number" placeholder="e.g., 120" />
          <label class="mini">Category</label>
          <input id="eCat" placeholder="e.g., Food" />
          <label class="mini">Date</label>
          <input id="eDate" type="date" value="${todayISO()}" />
          <label class="mini">Note (optional)</label>
          <input id="eNote" placeholder="Note" />
        </div>
      `, ()=>{
        const title = document.getElementById('eTitle').value.trim() || 'Expense';
        const amount = Number(document.getElementById('eAmt').value) || 0;
        if(!amount){ alert('Enter valid amount'); return; }
        const category = document.getElementById('eCat').value.trim() || 'General';
        const date = document.getElementById('eDate').value || todayISO();
        const note = document.getElementById('eNote').value.trim();
        const tx = { id: genId(), type:'expense', title, amount: -Math.abs(amount), category, date, note };
        state.transactions.push(tx);
        renderAll();
      });
    });

    // edit transaction
    function openEditTransaction(id){
      const tx = state.transactions.find(x=>x.id===id);
      if(!tx) return;
      openModal('Edit Transaction', `
        <div class="form-row">
          <label class="mini">Title</label>
          <input id="editTitle" value="${tx.title.replace(/"/g,'&quot;')}" />
          <label class="mini">Amount (â‚¹)</label>
          <input id="editAmt" type="number" value="${Math.abs(tx.amount)}" />
          <label class="mini">Type</label>
          <select id="editType"><option value="income">Income</option><option value="expense">Expense</option></select>
          <label class="mini">Category</label>
          <input id="editCat" value="${(tx.category||'').replace(/"/g,'&quot;')}" />
          <label class="mini">Date</label>
          <input id="editDate" type="date" value="${tx.date || todayISO()}" />
          <label class="mini">Note</label>
          <input id="editNote" value="${(tx.note||'').replace(/"/g,'&quot;')}" />
        </div>
      `, ()=>{
        tx.title = document.getElementById('editTitle').value.trim() || tx.title;
        const amt = Number(document.getElementById('editAmt').value) || 0;
        const type = document.getElementById('editType').value;
        tx.amount = type === 'expense' ? -Math.abs(amt) : Math.abs(amt);
        tx.category = document.getElementById('editCat').value.trim();
        tx.date = document.getElementById('editDate').value || todayISO();
        tx.note = document.getElementById('editNote').value.trim();
        renderAll();
      });

      // set type dropdown to current type
      setTimeout(()=> { document.getElementById('editType').value = tx.type; }, 50);
    }

    function deleteTransaction(id){
      state.transactions = state.transactions.filter(x=>x.id!==id);
      renderAll();
    }

    // set budget
    setBudgetBtn.addEventListener('click', ()=>{
      const v = Number(budgetInput.value);
      if(!v || v <= 0){ alert('Enter valid budget'); return; }
      state.monthlyBudget = v;
      budgetInput.value = '';
      renderAll();
    });

    // clear & export
    clearAllBtn.addEventListener('click', ()=> {
      if(confirm('Clear all transactions?')){
        state.transactions = [];
        renderAll();
      }
    });
    exportBtn.addEventListener('click', ()=>{
      const data = JSON.stringify(state, null, 2);
      const blob = new Blob([data], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'budget-export.json'; a.click();
      URL.revokeObjectURL(url);
    });

    // initial stroke setup
    (function initProgress(){
      const C = 2*Math.PI*40;
      progressCircle.style.strokeDasharray = C.toFixed(3);
      progressCircle.style.strokeDashoffset = C.toFixed(3);
    })();

    // initial render
    renderAll();

    // close modal on escape
    document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeModal(); });

    // persist on unload
    window.addEventListener('beforeunload', saveState);
  </script>
</body>
</html>
